<mujoco model="trifinger_with_ground">


    <visual>
        <global offwidth="1280" offheight="960"/>
    </visual>

    <compiler angle="radian" meshdir="assets"/>

    <option cone="elliptic" impratio="100.0" integrator="Euler"
            iterations="100" ls_iterations="10" solver="Newton" tolerance="0"
            noslip_iterations="0">
        <flag eulerdamp="enable"
              clampctrl="disable"
              warmstart="enable"
              frictionloss="enable"
              fwdinv="enable"
              midphase="enable"
              multiccd="disable"
              invdiscrete="disable"/>
    </option>

    <size njmax="500" nconmax="100"/>

    <asset>
        <mesh name="SIM__BL_Finger_Base" file="SIM__BL-Finger_Base.stl"/>
        <mesh name="SIM__BL_Finger_Proximal" file="SIM__BL-Finger_Proximal.stl"/>
        <mesh name="SIM__BL_Finger_Intermediate" file="SIM__BL-Finger_Intermediate.stl"/>
        <mesh name="SIM__BL_FINGER_TIP_LINK" file="SIM_BL_FINGER_TIP_LINK.stl"/>

        <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4"
                 rgb2="0.1 0.2 0.3" markrgb="0.8 0.8 0.8" width="300" height="300"/>
        <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5"
                  reflectance="0.0"/>
    </asset>

    <worldbody>

        <!-- Light and camera -->
        <light directional="true" ambient="0.2 0.2 0.2"
               diffuse="0.8 0.8 0.8" castshadow="false"
               pos="0 1 4" dir="0 0 -1" name="light0"/>
        <camera name="demo-cam" pos="-0.005 -0.529 0.575"
                xyaxes="1.000 -0.002 -0.000 0.001 0.644 0.765"/>

        <!-- Table geom: collisions on (contype=1, conaffinity=1) -->
        <geom name="table" rgba="0.8 0.8 0.8 1.0" friction="0.8"
              size="0 0 0.05" type="plane" material="groundplane"
              condim="6"
              contype="1" conaffinity="1"/>

        <!-- ================== Trifinger Base (shells) ================== -->
        <!-- contype=1, conaffinity=2 => collides with table, but not with each other -->
        <geom pos="0 0.219 0.29" type="mesh"
              mesh="SIM__BL_Finger_Base"
              rgba="0.5 0 0 1"
              contype="1" conaffinity="2"/>

        <geom pos="0.18966 -0.1095 0.29" quat="0.5 0 0 -0.866025"
              type="mesh" mesh="SIM__BL_Finger_Base"
              rgba="0 0.5 0 1"
              contype="1" conaffinity="2"/>

        <geom pos="-0.18966 -0.1095 0.29" quat="-0.5 0 0 -0.866025"
              type="mesh" mesh="SIM__BL_Finger_Base"
              rgba="0 0.5 0.5 1"
              contype="1" conaffinity="2"/>


        <!-- ================== ARM 1 (0 deg) ================== -->
        <body name="finger_upper_link_0" pos="0 0.04 0.29">
            <inertial pos="0 0.06 0" quat="0.707107 0.707107 0 0"
                      mass="0.2" diaginertia="0.000353333 0.000353333 5.33333e-05"/>
            <joint name="finger_base_to_upper_joint_0" pos="0 0 0"
                   axis="0 1 0" limited="true" range="-1.5708 1.5708"/>

            <!-- Proximal link geometry -->
            <geom pos="0 -0.02695 0" type="mesh"
                  mesh="SIM__BL_Finger_Proximal"
                  rgba="0.5 0 0 1"
                  contype="1" conaffinity="2"/>

            <body name="finger_middle_link_0" pos="0 0 0">
                <inertial pos="0.028 0 -0.08" mass="0.2"
                          diaginertia="0.000353333 0.000353333 5.33333e-05"/>
                <joint name="finger_upper_to_middle_joint_0" pos="0 0 0"
                       axis="-1 0 0" limited="true"
                       range="-1.35263 4.49422"/>
                <!-- Intermediate link geometry -->
                <geom pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                      type="mesh" mesh="SIM__BL_Finger_Intermediate"
                      rgba="0.5 0 0 1"
                      contype="1" conaffinity="2"/>

                <body name="finger_lower_link_0" pos="0 0 -0.16">
                    <inertial pos="0 0 -0.126667" mass="0.03"
                              diaginertia="8.36667e-05 8.36667e-05 1e-06"/>
                    <joint name="finger_middle_to_lower_joint_0" pos="0 0 0"
                           axis="1 0 0" limited="true"
                           range="-3.00197 3.00197"/>
                    <!-- Tip link geometry -->
                    <geom name="finger_tip_0"
                          friction="0.9 0.005 0.0001"
                          pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                          type="mesh" mesh="SIM__BL_FINGER_TIP_LINK"
                          rgba="0.5 0 0 1"
                          contype="1" conaffinity="2"/>
                </body>
            </body>
        </body>

        <!-- ================== ARM 2 (120 deg) ================== -->
        <body name="finger_upper_link_120" pos="0.034641 -0.02 0.29"
              quat="0.5 0 0 -0.866025">
            <inertial pos="0 0.06 0" quat="0.707107 0.707107 0 0"
                      mass="0.2" diaginertia="0.000353333 0.000353333 5.33333e-05"/>
            <joint name="finger_base_to_upper_joint_120" pos="0 0 0"
                   axis="0 1 0" limited="true" range="-1.5708 1.5708"/>

            <geom pos="0 -0.02695 0" type="mesh"
                  mesh="SIM__BL_Finger_Proximal"
                  rgba="0 0.5 0 1"
                  contype="1" conaffinity="2"/>

            <body name="finger_middle_link_120" pos="0 0 0">
                <inertial pos="0.028 0 -0.08" mass="0.2"
                          diaginertia="0.000353333 0.000353333 5.33333e-05"/>
                <joint name="finger_upper_to_middle_joint_120" pos="0 0 0"
                       axis="-1 0 0" limited="true"
                       range="-1.35263 4.49422"/>
                <geom pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                      type="mesh" mesh="SIM__BL_Finger_Intermediate"
                      rgba="0 0.5 0 1"
                      contype="1" conaffinity="2"/>

                <body name="finger_lower_link_120" pos="0 0 -0.16">
                    <inertial pos="0 0 -0.126667" mass="0.03"
                              diaginertia="8.36667e-05 8.36667e-05 1e-06"/>
                    <joint name="finger_middle_to_lower_joint_120" pos="0 0 0"
                           axis="1 0 0" limited="true"
                           range="-3.00197 3.00197"/>
                    <geom name="finger_tip_120"
                          friction="0.9 0.005 0.0001"
                          pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                          type="mesh" mesh="SIM__BL_FINGER_TIP_LINK"
                          rgba="0 0.5 0 1"
                          contype="1" conaffinity="2"/>
                </body>
            </body>
        </body>

        <!-- ================== ARM 3 (240 deg) ================== -->
        <body name="finger_upper_link_240" pos="-0.034641 -0.02 0.29"
              quat="-0.5 0 0 -0.866025">
            <inertial pos="0 0.06 0" quat="0.707107 0.707107 0 0"
                      mass="0.2" diaginertia="0.000353333 0.000353333 5.33333e-05"/>
            <joint name="finger_base_to_upper_joint_240" pos="0 0 0"
                   axis="0 1 0" limited="true" range="-1.5708 1.5708"/>

            <geom pos="0 -0.02695 0" type="mesh"
                  mesh="SIM__BL_Finger_Proximal"
                  rgba="0 0.5 0.5 1"
                  contype="1" conaffinity="2"/>

            <body name="finger_middle_link_240" pos="0 0 0">
                <inertial pos="0.028 0 -0.08" mass="0.2"
                          diaginertia="0.000353333 0.000353333 5.33333e-05"/>
                <joint name="finger_upper_to_middle_joint_240" pos="0 0 0"
                       axis="-1 0 0" limited="true"
                       range="-1.35263 4.49422"/>
                <geom pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                      type="mesh" mesh="SIM__BL_Finger_Intermediate"
                      rgba="0 0.5 0.5 1"
                      contype="1" conaffinity="2"/>
                <body name="finger_lower_link_240" pos="0 0 -0.16">
                    <inertial pos="0 0 -0.126667" mass="0.03"
                              diaginertia="8.36667e-05 8.36667e-05 1e-06"/>
                    <joint name="finger_middle_to_lower_joint_240" pos="0 0 0"
                           axis="1 0 0" limited="true"
                           range="-3.00197 3.00197"/>
                    <geom name="finger_tip_240"
                          friction="0.9 0.005 0.0001"
                          pos="0.014 0 0" quat="0.707107 0.707107 0 0"
                          type="mesh" mesh="SIM__BL_FINGER_TIP_LINK"
                          rgba="0 0.5 0.5 1"
                          contype="1" conaffinity="2"/>
                </body>
            </body>
        </body>

    </worldbody>


    <actuator>
        <position name="finger_base_to_upper_joint_0"   joint="finger_base_to_upper_joint_0"/>
        <position name="finger_upper_to_middle_joint_0" joint="finger_upper_to_middle_joint_0"/>
        <position name="finger_middle_to_lower_joint_0" joint="finger_middle_to_lower_joint_0"/>

        <position name="finger_base_to_upper_joint_120"   joint="finger_base_to_upper_joint_120"/>
        <position name="finger_upper_to_middle_joint_120" joint="finger_upper_to_middle_joint_120"/>
        <position name="finger_middle_to_lower_joint_120" joint="finger_middle_to_lower_joint_120"/>

        <position name="finger_base_to_upper_joint_240"   joint="finger_base_to_upper_joint_240"/>
        <position name="finger_upper_to_middle_joint_240" joint="finger_upper_to_middle_joint_240"/>
        <position name="finger_middle_to_lower_joint_240" joint="finger_middle_to_lower_joint_240"/>
    </actuator>

    <sensor>
        <!-- Positions of finger tips w.r.t the table -->
        <framepos name="finger_tip_0"     objtype="geom" objname="finger_tip_0"   reftype="geom" refname="table"/>
        <framepos name="tip_position_120" objtype="geom" objname="finger_tip_120" reftype="geom" refname="table"/>
        <framepos name="tip_position_240" objtype="geom" objname="finger_tip_240" reftype="geom" refname="table"/>
    </sensor>

    <keyframe>
        <!-- Default key with some initial positions/controls -->
        <key name="default"
             qpos="0.0 -0.6 -1.2  0.0 -0.6 -1.2  0.0 -0.6 -1.2"
             ctrl="0.0 -0.6 -1.2  0.0 -0.6 -1.2  0.0 -0.6 -1.2"/>
    </keyframe>

</mujoco>
